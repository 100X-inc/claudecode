---
tags:
  - research
  - claude-code
  - progressive-disclosure
  - context-optimization
created: 2026-01-11
source: web-researcher
---

# Progressive Disclosure - コンテキスト最適化

## 概要

Progressive Disclosureを活用したコンテキストウィンドウの最適化手法について解説する。

## コンテキストウィンドウの制限

| プラン | コンテキストサイズ |
|--------|-------------------|
| 標準（全モデル） | 200Kトークン |
| Enterprise（Claude Sonnet 4） | 500Kトークン |
| Tier 4組織 | 1Mトークン |

## 指示遵守の限界

研究によると:
- **Frontier Thinking LLM**: 約150-200個の指示を一貫して遵守可能
- **小型モデル**: より少ない指示にしか従えない
- **Non-thinking モデル**: Thinking モデルより遵守率が低い

**重要**: 小型モデルは指示数の増加に対して**急速に**パフォーマンスが劣化する

## Progressive Disclosureによる最適化

### 従来のアプローチ（非効率）

```markdown
# CLAUDE.md
すべての指示をここに記載...
- ビルド手順（50行）
- テスト方法（30行）
- コーディング規約（100行）
- アーキテクチャ説明（80行）
- データベーススキーマ（60行）
...
合計: 300+ 行 → 毎セッション読み込み
```

### Progressive Disclosureアプローチ（効率的）

```markdown
# CLAUDE.md（20行程度）
クイックリファレンスと詳細ファイルへのポインタのみ

# 詳細ファイル（必要時のみ読み込み）
agent_docs/building.md
agent_docs/testing.md
agent_docs/conventions.md
```

**効果**: 54%のトークン削減が報告されている（GitHub事例）

## Skillsの3層最適化

| レイヤー | 読み込み条件 | トークン消費 |
|---------|-------------|-------------|
| メタデータ | 常時 | 約100トークン |
| SKILL.md本体 | スキル発動時 | 500-5,000トークン |
| バンドルリソース | 実際に必要時 | 可変 |

### 実装例

```
pdf-skill/
├── SKILL.md           # 発動時に読み込み（~500行）
├── FORMS.md           # フォーム処理時のみ
├── reference.md       # API参照時のみ
└── scripts/
    └── analyze.py     # 実行時のみ（コンテキスト消費なし）
```

## 最適化テクニック

### 1. Hooks活用

冗長な指示の代わりにHooksを使用:

```markdown
# 非効率（CLAUDE.mdに記載）
NEVER use WebSearch tool.
IMPORTANT: Always use alternative search method.
YOU MUST NOT invoke WebSearch under any circumstances.

# 効率的（PreToolUse Hook）
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "WebSearch",
      "action": "block",
      "message": "Use MCP search instead"
    }]
  }
}
```

### 2. 条件付き読み込み

ディレクトリ構造で自動スコープ:

```
project/
├── CLAUDE.md           # プロジェクト全体
├── frontend/
│   └── CLAUDE.md       # フロントエンド作業時のみ
└── backend/
    └── CLAUDE.md       # バックエンド作業時のみ
```

Claudeは作業対象のサブツリーに入った時のみ、そのCLAUDE.mdを読み込む。

### 3. Rules ディレクトリでのスコープ

```yaml
# .claude/rules/testing.md
---
paths:
  - "**/*.test.ts"
  - "**/*.spec.ts"
---

# テストファイル作業時のみ適用されるルール
テストは describe/it 形式で記述...
```

### 4. コンテキスト管理コマンド

| コマンド | 用途 |
|---------|------|
| `/compact` | 会話を要約してコンテキスト削減 |
| `/clear` | セッションをクリア |
| `/context` | コンテキスト使用状況の確認（v1.0.86+） |

**推奨**: コンテキスト50%到達時に `/compact` 実行

### 5. 大規模ファイルの目次

100行を超えるファイルには目次を配置し、部分読み込みでも全体像が把握可能に:

```markdown
# API Reference

## 目次
1. 認証
2. ユーザー管理
3. データ操作
4. Webhook
5. エラーハンドリング

---

## 1. 認証
...
```

## パフォーマンス推奨

### コンテキスト使用率別

| 使用率 | 推奨アクション |
|--------|---------------|
| 0-50% | 通常運用 |
| 50-80% | `/compact` 検討 |
| 80%+ | 複雑なタスクは避ける |

### トークン節約のベストプラクティス

1. **タスク固有の指示はチャットで**: CLAUDE.mdには入れない
2. **未使用ファイルを定期削除**: プロジェクトファイルの整理
3. **Extended Thinking の適切な使用**: 不要な場合はオフ
4. **ツール・コネクタの管理**: 非必須なものは無効化

## 関連ノート

- [[00_概要]] - Progressive Disclosureの基本概念
- [[01_実装パターン]] - 具体的な実装方法
- [[02_ベストプラクティス]] - 公式推奨事項

## ソース

- [Claude Code Context Optimization - GitHub Gist](https://gist.github.com/johnlindquist/849b813e76039a908d962b2f0923dc9a) - 取得日: 2026-01-11
- [Context and Memory Management in Claude Code](https://angelo-lima.fr/en/claude-code-context-memory-management/) - 取得日: 2026-01-11
- [Claude context window: token limits and 2025 rules](https://www.datastudios.org/post/claude-context-window-token-limits-memory-policy-and-2025-rules) - 取得日: 2026-01-11
- [Manage Claude's memory - Claude Code Docs](https://code.claude.com/docs/en/memory) - 取得日: 2026-01-11
