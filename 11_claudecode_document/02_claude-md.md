---
name: claude-md
description: CLAUDE.mdの書き方とベストプラクティス
---

# 良いCLAUDE.mdの書き方
Kyle · 2025年11月25日 · < 10分で読めます

注: 本記事は、OpenCode、Zed、Cursor、Codexのようなエージェントやハーネス向けのオープンソース版「AGENTS.md」にも適用できます。

## 原則：LLMは（ほとんど）ステートレス
LLM（大規模言語モデル）はステートレスな関数です。推論に使われる時には重みが固定されており、使い続けても学習しません。モデルがあなたのコードベースについて知っているのは、あなたがインプットしたトークンだけです。

同様に、Claude Codeのようなコーディングエージェントハーネスも通常はエージェントのメモリ管理を明示的に行う必要があります。CLAUDE.md（またはAGENTS.md）は、デフォルトであなたがエージェントとするすべての会話に含まれる唯一のファイルです。

これには重要な3つの意味があります：

- コーディングエージェントは、各セッションの開始時にはあなたのコードベースについてまったく何も知りません。
- セッションを始めるたびに、エージェントにそのコードベースについて重要なことを教えなければなりません。
- そのためにはCLAUDE.mdを使うのが最適です。

## CLAUDE.mdでClaudeをコードベースにオンボーディングする
Claudeは各セッションごとにコードベースについて何も知らないため、CLAUDE.mdを使ってオンボーディングを行うべきです。大まかには、以下をカバーします：

WHAT：Claudeに技術構成やスタック、プロジェクト構成を教えてください。Claudeにコードベースの地図を与えましょう。これはモノレポでは特に重要です！アプリや共通パッケージが何か、それぞれが何のためにあるのかを明確に伝え、探すべき場所を把握できるようにしましょう。
WHY：プロジェクトの目的やリポジトリ内で各部分が担っている役割をClaudeに伝えます。プロジェクト内の各部分の目的・機能とは何でしょうか？
HOW：Claudeがプロジェクト上でどう作業すべきかを伝えます。例えば、Nodeの代わりにbunを使っていますか？Claudeがプロジェクトで有意義な作業を行うのに必要な情報はすべて記載してください。Claudeの変更をどう検証できますか？テストや型チェック、ビルドはどう行いますか？
ただし、必要なすべてのコマンドをCLAUDE.mdに詰め込もうとするのは避けてください。そうすると結果が悪化します。

## ClaudeはしばしばCLAUDE.mdを無視する
どのモデルを使っている場合でも、Claudeが頻繁にCLAUDE.mdの内容を無視することに気づくかもしれません。

この動作は、CLAUDEコードCLIとAnthropic APIの間にロギングプロキシを置き、ANTHROPIC_BASE_URLを使用して自分で検証できます。Claude Codeは、エージェントへのユーザーメッセージ内にCLAUDE.mdの内容とともに以下のシステムリマインダーを挿入します：

<system-reminder>
      重要：このコンテキストがあなたのタスクに関係あるかは分かりません。
      非常に関連性が高い場合以外は、このコンテキストに反応しないでください。
</system-reminder>
そのため、現在のタスクに関連性がないとClaudeが判断した場合は、CLAUDE.mdの内容を無視します。ファイル内の情報が普遍的でなければないほど、Claudeが指示を無視する可能性が高くなります。

なぜAnthropicはこの仕組みを導入したのでしょうか？断言はできませんが、推測できます。多くのCLAUDE.mdファイルにはあまり汎用的とはいえない指示が詰め込まれていることが多いのです。多くのユーザーが、その場しのぎの「ホットフィックス」を追加する感覚で指示を書いてしまっています。

Claude Codeチームは、不要な指示を無視するようClaudeに伝えることで、ハーネスがより良い成果を生んだと判断したのでしょう。

## 良いCLAUDE.mdファイルの作成
以下は、コンテキストエンジニアリングのベストプラクティスに従った良いCLAUDE.mdを書くための推奨事項です。

必ずしもこれらすべてがあなたのセットアップに最適とは限りません。常にルールを破ってもよいタイミングや理由を理解しておきましょう。

- いつ、なぜ破ってよいか理解している
- そのための十分な理由がある

### 指示は少ないほど効果的
Claudeが実行する可能性のあるすべてのコマンドや、コード規約・スタイルガイドラインをCLAUDE.mdに詰め込みたくなるかもしれませんが、これはおすすめしません。

この分野の厳密な検証は多くありませんが、いくつかの研究から以下が分かっています：

- 最先端LLMは大体150～200個の命令まで一貫して守れます。小さなモデルや、推論能力の低いモデルはこの数がさらに少なくなります。
- 小規模モデルは命令数が増えると急激に性能が低下します。大規模モデルはより緩やかに劣化します（線形的）。そのため、複雑な手順や実装プランには小さなモデルの利用は推奨できません。
- LLMはプロンプトの端、つまり最初（Claude CodeのシステムメッセージやCLAUDE.md）や最後（直近のユーザーメッセージ）の命令を優先しがちです。
- 指示の数が増えると全体の命令遵守率が均等に下がります。新しい命令に切り替えるだけでなく、すべての命令を徐々に無視するようになります。

Claude Codeハーネスのシステムプロンプトには約50個の命令が含まれています。モデル次第では、エージェントが信頼して従える命令群の約3分の1をすでに消費していることになります（ルールやプラグイン、スキル、ユーザーメッセージを除く）。

つまり、CLAUDE.mdにはタスクに対して普遍的に適用できる命令だけを、できるだけ少なく記述するべきです。

### CLAUDE.mdの長さと適用範囲
あらゆる条件が同じ場合、LLMは文脈ウィンドウに集中的で関連性の高いコンテキスト（例や関連ファイル、ツール呼び出し、ツール結果など）が詰まっているほうが、無関係なコンテキストだらけの状況よりもタスクをうまくこなします。

CLAUDE.mdはすべてのセッションに挿入されるため、その内容はできるだけ普遍的であるべきです。

例えば、「新しいデータベーススキーマの設計」についての指示は、他の無関係なタスクでは邪魔になってしまうので含めるべきではありません。

「少ないほど良い」という原則はファイルの長さにも当てはまります。Anthropicの公式な推奨はありませんが、一般的には300行未満が最適、もっと短い方が良いとされています。

HumanLayer社では、ルートCLAUDE.mdは60行未満です。

### 漸進的開示（Progressive Disclosure）
大きなプロジェクトでは、Claudeに知らせたいことをすべて簡潔に盛り込むのは大変です。

この課題に対処するには、「漸進的開示（Progressive Disclosure）」の原則を活用し、Claudeが必要なときにだけタスクやプロジェクトに固有の指示を見られるようにします。

プロジェクトのビルド方法、テスト実行、コード規約などの情報をすべてCLAUDE.mdに記載するかわりに、それぞれ自己記述的な名前のMarkdownファイルに分割して格納するのがお勧めです。

例：

agent_docs/
  |- building_the_project.md
  |- running_tests.md
  |- code_conventions.md
  |- service_architecture.md
  |- database_schema.md
  |- service_communication_patterns.md

CLAUDE.mdには、これらのファイルのリストと簡単な説明を載せておき、必要なものをClaudeが選んで読むよう指示するか、読む前に必要なファイルをClaudeが提案し、承認を求めてくるようにしてもよいでしょう。

コピーよりもポインタ（参照）を書きましょう。コードスニペットは、なるべく記載しないでください。すぐに古くなります。代わりに、“ファイル:行番号”のような形で、最新の情報源への参照を付けましょう。

この設計思想は、「Claudeスキル」（tool寄りの運用ですが）にも近いコンセプトです。

### Claudeは（高価な）リンターではない
CLAUDE.mdによく含められるもののひとつが、コードスタイルガイドです。LLMをリンター代わりに使ってはいけません。従来のリンターやフォーマッターと比べて、LLMは高コストかつ低速です。可能な限り決定論的なツールを使うべきです。

コードスタイルガイドを追加すると、指示や無関係なコードスニペットが膨れ上がり、LLMのパフォーマンスや命令遵守能力を低下させ、コンテキストウインドウを浪費します。

LLMは“インコンテキスト・ラーナー”です。もしあなたのコードベースが一定のスタイルやパターンに従っていれば、少し検索したりリサーチドキュメントを添えれば、エージェントも自然と既存のパターンに従うはずです。

それでもどうしても必要な場合は、Claude Codeの「Stopフック」機能を使って、フォーマッターやリンターを自動で実行し、エラーだけをClaudeに修正させる仕組みも検討できます。Claudeに自分でフォーマット違反を探させないことが重要です。

お勧めは、自動修正機能付きのリンター（Biomeなど）を使い、安全に自動修正可能なルールを十分に吟味して適用することです。

あるいは、コードガイドラインを含めたSlashコマンドを用意し、バージョン管理上の変更箇所やgit statusなどを指示し、実装とフォーマットを分離して対応することもできます。両方の精度と効率が向上するでしょう。

### /initや自動生成CLAUDE.mdは使わない
Claude CodeやOpenCode系のハーネスには、CLAUDE.md（またはAGENTS.md）自動生成機能があります。

CLAUDE.mdはClaude codeの全てのセッションで毎回使われるため、良くも悪くも、ハーネス全体の成果に強く影響します。

悪い1行のコードは悪い1行のコードにすぎません。しかし、悪い実装プランの1行は、それがもとになって多くの悪いコードを生みます。システムの理解を誤ったリサーチの1行は、不適切なプランへ、さらに多くの悪いコードへとつながります。

CLAUDE.mdはワークフローのすべての段階、すべての成果物に影響します。そのため、1行1行慎重に考えて書くことを強くおすすめします。

レバレッジ（てこの原理）は強力です。

## まとめ
- CLAUDE.mdの役割は、Claudeをあなたのコードベースにオンボーディングすること。そのためにはWHY、WHAT、HOWを明記しましょう。
- 指示は最小限に。必要なものを省いてはなりませんが、「できるだけ少なく」するのがコツです。
- CLAUDE.mdの内容は簡潔かつ普遍的にしましょう。
- 漸進的開示を活用し、「知っていてほしいことをすべて」詰め込まず、「必要なとき、必要な情報が見つかる方法」を教えましょう。これでコンテキストウインドウや命令数の肥大化を防げます。
- Claudeはリンターではありません。スタイルチェックにはリンターやフォーマッターを、他の用途にはHookやSlashコマンドなど適材適所で活用しましょう。
- CLAUDE.mdは最重要のレバレッジポイントなので、自動生成せず、手作業で内容を練り上げるのがベストです。
